##  GoBuster
Is a brute force attack that help find hidden directories and pages, it will take a list of potential page or directory names and tries accessing a website with each of them.

gobuster -e -u https://192.168.x.x -w /usr/share/wordlists/dirb/common.txt

-e print full URLs of discovered paths
-u website
-w directory for the wordlist

pages with status 200 are correct.

##  NMap

Port scanning tool.
-sT TCP
*   If we send an TCP request to an open port we have SYN > SYN,ACK > ACK.
*   If we send an TCP request to a close port we have SYN > RST(Reset).
Many firewalls are configured to drop incoming packets even if the port is open, so if we receive nothing back that's the case.

-sS SYN half open
Are used to scan the TCP port-range of a target or targets, SYN scans are sometimes referred to as Half open or Stealth.
TCP send back an RST instead an ACK at the end. This prevent the server from repeatedly trying to make the request.
*   SYN scans are often not logged by application listening on open ports.
SYN scans arefaster than a TCP scan.
*   They need sudo permissions to full work in linux, this because it requires to create ra packets.
*   Unstable services are sometimes brought down by SYN scans.

-sU UDP scans
UDP is a stateless connection, this means that when a packet is sent to an UDP port should not be any response. Nmap refers tot he port as being open|filtered, in other word the port is open but it could be firewalled. If it gets response the port is marked as open. 
When the port is closed nmap receive the unreachable message. For this usually are scanned only a close number of UDP ports using this
namp -sU --top-ports 20 "target".

```
-sN TCP null
Are TCP requests with no flags set at all(no SYN flag so the next step will be an RST,ACK flag). The target should respond with RST if the port is closed.

-sF TCP FIN scans
This instead pf sending a completly empty packet, a request is sent with the FIN flag(ususally used to gracefully close an active connect). Nmap expect RST if the port is closed.

-sX TCP Xmas
This send an malformed packets(using PSH, URG and FIN flags) and expect an RST response for closed port.

The expected response for open ports with these 3 scans is identical and very similar to that of the UDP scan(open|filtered, closed, or filtered).
Windows and a lot of Cisco network devices are know to respond with a RST to any malformed TCP packet. 
This result in all ports showing up as being closed. 
These are used to bypass firewall security, by sending that not containt the SYN flag we bypass this kind of firewall.
```
# IP with actives hosts

We use the "ping sweep", nmap sends an ICMP packet to each possible IP for the specified network.
```nmap -sn 192.168.0.1-254 / nmap -sn 192.168.0.0/24```
The -sN tells to don't scan for ports, first rely on ICMP echo packets(ARP on a local network if run with sudo or directly as the root user). This also cause nmap to send an TCP SYN packet to port 443 of the target as well as a TCP ACK(or TCP SYN if no as root) packet to port 80 of the target.

#   Nmap Script Engine(NSE)

Nmap scripts are written in the Lua language.
    safe: don't affect the target
    intrusive: likely affect the target
    vuln: scan for vulnerabilities
    exploit: attempt to exploit a vulnerability
    auth: bypass authentication for running services
    brute: bruteforce credentials
    discovery: query running services for futher information about the network.
All script are [here](https://nmap.org/book/nse-usage.html).


To run one of ths¡ose script we use --script="script-name".
Can be used multiply scripts at once 
```--script=smb-enum-users,smb-enum-shares```.
There script that need credentials, like the http-put(upload files using the put method)
```nmap -p 80 --script http-put --script-args http-put.url='/dav/shell.php',http-put.file='./shell.php'```.
Nmap has also help manus accessible usin 
```nmap --script-help "script-name"```.

The machine stores all script in */usr/share/nmap/scripts*. 
It is possible to serach for words like
```grep "ftp" /usr/share/nmap/scripts/scripts.db```
```ls -l /usr/share/nmap/scripts/*ftp*```
```grep "safe" /usr/share/nmap/scripts/script.db```.

If we want to install scripts not already presents, we can download from the web using ```sudo wget -O /usr/share/nmap/scripts/<script-name>.nse https://svn.nmap.org/nmap/scripts/<script-name>.nse``` and than update the table using ```nmap --script-updatedb```.

## Firewall evasion

Nmap will consider a host with this config as dead and not bother scanning it at all.
-Pn tells Nmap to not bother pinging the host before scanning it, this means that nmap will always treat the target host as being alive, bypassing the ICMP block.
-f fragment the packets making them less lickely to being identified from a firewall
    --mtu "number" accepts a maximum transmission unit size to use for the packets sent. Must be a multiple of 8.
--scan-delay "times"(ms) add a delay between packets sent, if sentwork is unstable but also for evading any time-based fireaal/IDS
--badsum is used to generate in invalid checksume for packets(some data do not correspond to the original one), any real TCP/IP stack would drop this packet, however firewalls may potentially respond automatically withouth bother to check it.
--data-length "number of bytes" tells nmap to generate random bytes and append them as data in the request.
[Other way to avoid firewall with Nmap](https://nmap.org/book/man-bypass-firewalls-ids.html).

## Metaslpoit

Is the most used exploitation framework.
The pro version is the commercial one that facilitates the automatation and management of tasks with a GUI and the framework version is open-source that use CMD.

This tool allow infomation gathering, scannin, exploitation, exploitation development, post-exploitation and more.

*   msfconsole: main CMD interface
*   Modules: supporting modules like exploits, scanners, payload, etc
*   Tools: Stand alone tools that will help vulnerability research, assessment or penetration testing. Some of them are msfvenom, patter_create and patter_offset.

*   Exploit: a piece of code that uses a vulnerability
*   Vulnerability: a design, coding or logic flaw affecting the system.
*   Payload: an exploit will take advantage of a vulnerability, but if we want to reach the result we want we must use playloads(code that is esecuted on the target system).


ALL OF THE NEXT WILL BE LOCATED IN ```/usr/share/metasploit-framework/modules```

# Auxiliary
Any supporting module like scanners, crawlers and fuzzers.

# Encoders
These will allow to encode the exploit and payload in the hope that a signature based antivirus solution may miss them. AntiVirus have a database of known threats, they detect them by comparing suspicious files to their database and riase an alert if there is a match.

# Evasion
While encoders will encode the payload, evasion should not be considered a direct attempt to evade antivirus software. Meanwhile evasion modules will try that, with more or less succes.

# Exploits
Organized by target system.

# NOPs
No Operation do nothing. They are used to make the PC do nothing for 1 cycle, are used as a buffer to achieve consistent payload sizes.

# Payloads
Are codes that will be executed in the target system.
They will leverage a vulnerability on the target system but we will also need an payload. Metasploit offers the ability to send different payloads that can open shells on the target system.
*       Adapters: wraps single payloads to convert them into different formats.(Ex: a normal payload can be wrapped inside a Powershell adapter which will make a single powershell command that will execute the payload).
*       Singles: self contained payloads that don't need to download an additional component to run.
*       Stagers: they set up a connection between Matesploit and the target system, usefull with "staged payloads"(they will first upload a stager on the target system than download the rest of the payload). This provides advantage as the initial size of the payload will be relatively small.
*       Stages: download by stager, this allow you to use larger sized payloads.
```
Metasploit has a subtle way to help you identify single (also called “inline”) payloads and staged payloads.
*       generic/shell_reverse_tcp
*       windows/x64/shell/reverse_tcp
The first is an inline (or single) payload, as indicated by the “_” between “shell” and “reverse”. While the last is a staged payload, as indicated by the “/” between “shell” and “reverse”.
```

# Post
Will be usefull on the final stage of the penTesting process listed above.

## Metasploit CMD

Using a modules with `use exploit/linux/....`.
Using `show options` we see the current configuration used atm.
With `back` u go out of the exploit menu and go back to normal metasploit framework.
Using `info` while in an submenu it will display all the information about.
With `search ....` will search the metasploit framework database for modules relevant to the given search parameter.

# Ranking

Exploits are ranked by their reliability.

*   ExcellentRanking: The exploit will never crash the service. This is the case for SQL Injection, CMD execution, RFI, LFI, etc. No typical memory corruption exploits should be given this ranking unless there are extraordinary circumstances (WMF Escape()).
*   GreatRanking: The exploit has a default target AND either auto-detects the appropriate target or uses an application-specific return address AFTER a version check.
*   GoodRanking: The exploit has a default target and it is the “common case” for this type of software (English, Windows 7 for a desktop app, 2012 for server, etc). Exploit does not auto-detect the target.
*   NormalRanking: The exploit is otherwise reliable, but depends on a specific version that is not the “common case” for this type of software and can’t (or doesn’t) reliably autodetect.
*   AverageRanking: The exploit is generally unreliable or difficult to exploit, but has a success rate of 50% or more for common platforms.
*   LowRanking: The exploit is nearly impossible to exploit (under 50% success rate) for common platforms.
*   ManualRanking: The exploit is unstable or difficult to exploit and is basically a DoS (15% success rate or lower). This ranking is also used when the module has no use unless specifically configured by the user (e.g.: exploit/unix/webapp/php_eval).

You can make a search utilizing the rank `search type:auxiliary telnet`

## HANDS ON MODULES

A web exploit could have an RPORT (remote port: the port on the target system Metasploit will try to connect to and run the exploit) value preset to 80, but your target web application could be using port 8080.
In case there are some options (`show options`) you want to change, just use `set <option> <value>`(F.E. change RHOST to an IP `set RHOST <ip>`). Or you can bring everything to default using `unset all` or `unset <option>` for just one option.
You can set `setg`(set global) to set all the variable you will use for all modules.

*   RHOST: remote host, the IP address of the target system. Is possible to set a range of IP or using an text file with all the IP you want to attack.
*   RPORT: remote port, the port of the target system where the vulnerable application is running on
*   PAYLOAD: the payload you will use with the exploit
*   LHOST: localhost, the attacking machine IP 
*   LPORT: local port, the port you will use for the reverse shell to connect back to. You can set any port not used by another app.
*   SESSION: each session will have an ID.

Launch an exploit with `exploit`, with `-z` the command will run the exploit and background the session as soon as it opens.
Once the exploit end, you can choose to set the session created as background using `background`, and with `session` you have a list of existing sessions. To open any session `session <ID>`.